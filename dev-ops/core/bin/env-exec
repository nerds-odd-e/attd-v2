#! /usr/bin/env sh
dev_ops_path=$(dirname $0)/../../

exec_env=$1
exec_service=$2

. ${dev_ops_path}/core/main.env

real_path() {
	echo "$(cd "$1"; pwd)"
}

exec_dir="$(real_path "$(pwd)/$3")"

shift 3

target_path=${root_path}${exec_dir#$(real_path "$(pwd)/$(dirname $0)/${dev_ops_docker_root}")}

if ! tty -s 2>/dev/null; then
	tty_flag="-T"
fi

${dev_ops_path}/env-${exec_env} exec $tty_flag $exec_service /opt/current/dev-ops/core/env-bin/cd-exec "$target_path" "$@"

